<!DOCTYPE html>
<html lang="en"><head>
	
	<meta name="generator" content="Hugo 0.82.1" />
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	
	<meta property="og:title" content="Locust : 파이썬 기반 오픈 소스 로드 테스트">
	
	
	<meta name="keywords" content="python,loadtest,locust,opensource"><meta name="description" content="Locust Locust는 사용이 쉽고, 스크립트 가능하고, 확장 가능한 성능 테스트 도구이다. 유저들의 행동을 파이썬 코드를 사용해서 정의할 수 있다.
Locust 공식 GitHub 
Features 평범한 Python으로 사용자 테스트 시나리오 작 …"><meta property="og:title" content="Locust : 파이썬 기반 오픈 소스 로드 테스트" />
<meta property="og:description" content="Locust Locust는 사용이 쉽고, 스크립트 가능하고, 확장 가능한 성능 테스트 도구이다. 유저들의 행동을 파이썬 코드를 사용해서 정의할 수 있다.
Locust 공식 GitHub 
Features 평범한 Python으로 사용자 테스트 시나리오 작성 Locust는 경량 코루틴인 greenlet 내에서 모든 유저를 실행한다. 그렇기 때문에 콜백이나 다른 메커니즘을 사용하지 않고 일반 python 코드와 같은 테스트를 작성할 수 있다.
분산 &amp; 확장 가능 - 수 십만의 유저 지원 Locust를 사용하면 분산된 부하 테스트를 여러 시스템에 쉽게 동작 시킬 수 있다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pko89403.github.io/post/locust/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-25T14:56:52&#43;09:00" />
<meta property="article:modified_time" content="2021-04-25T14:56:52&#43;09:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Locust : 파이썬 기반 오픈 소스 로드 테스트"/>
<meta name="twitter:description" content="Locust Locust는 사용이 쉽고, 스크립트 가능하고, 확장 가능한 성능 테스트 도구이다. 유저들의 행동을 파이썬 코드를 사용해서 정의할 수 있다.
Locust 공식 GitHub 
Features 평범한 Python으로 사용자 테스트 시나리오 작성 Locust는 경량 코루틴인 greenlet 내에서 모든 유저를 실행한다. 그렇기 때문에 콜백이나 다른 메커니즘을 사용하지 않고 일반 python 코드와 같은 테스트를 작성할 수 있다.
분산 &amp; 확장 가능 - 수 십만의 유저 지원 Locust를 사용하면 분산된 부하 테스트를 여러 시스템에 쉽게 동작 시킬 수 있다."/>
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/all.css" />
	<link rel="stylesheet" href="/css/katex.min.css" crossorigin="anonymous">
	<script defer src="/js/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
	<script defer src="/js/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			renderMathInElement(document.body, {
				delimiters: [
					{left: "$$", right: "$$", display: true},
					{left: "$", right: "$", display: false}
				]
		});
		});
	</script><title>Locust : 파이썬 기반 오픈 소스 로드 테스트 | 유기농은 너무 비싸서 그런데 농약 친 건 어딨나요?</title>


</head>
<body><header>
	
	<div id="avatar">
		<a href="https://pko89403.github.io/">
		  <img src="/img/Avatar.png" alt="유기농은 너무 비싸서 그런데 농약 친 건 어딨나요?">
		</a>
	</div>
	
	<div id="titletext"><h2 id="title"><a href="https://pko89403.github.io/">유기농은 너무 비싸서 그런데 농약 친 건 어딨나요?</a></h2></div>
	<div id="title-description"><p id="subtitle"><a href=""></a></p><div id="social">
			<nav>
				<ul>
					<li><a href="https://github.com/pko89403"><i title="Github" class="icons fab fa-github"></i></a></li><li><a href="mailto:pko89403@gmail.com"><i title="Email" class="icons fas fa-envelope"></i></a></li></ul>
			</nav>
		</div>
	</div>
	
	<div id="mainmenu">
		<nav>
			<ul>
				
				<li><a href="/">Home</a></li>
				
				<li><a href="/post">All Posts</a></li>
				
				<li><a href="/about">About</a></li>
				
				<li><a href="/tags">Tags</a></li>
				
				<li><a href="/categories">Categories</a></li>
				
			</ul>
		</nav>
	</div>
	
</header>
<main><div class="post">
	
	<div class="author">
	
	</div>
	<div class="post-header">
	
		<div class="meta">
			
			<div class="date">
				<span class="day">25</span>
				<span class="rest">Apr 2021</span>
			</div>
			
		</div>
		
		<div class="matter">
			<h1 class="title">Locust : 파이썬 기반 오픈 소스 로드 테스트</h1>
		</div>
	</div>
	<div class="markdown">
		<h1 id="locust">Locust</h1>
<p>Locust는 사용이 쉽고, 스크립트 가능하고, 확장 가능한 성능 테스트 도구이다. <br>
유저들의 행동을 파이썬 코드를 사용해서 정의할 수 있다.</p>
<p><a href="https://github.com/locustio/locust" target="_blank">Locust 공식 GitHub </a></p>
<h2 id="features">Features</h2>
<h3 id="평범한-python으로-사용자-테스트-시나리오-작성">평범한 Python으로 사용자 테스트 시나리오 작성</h3>
<p>Locust는 경량 코루틴인 greenlet 내에서 모든 유저를 실행한다. 그렇기 때문에 콜백이나 다른 메커니즘을 사용하지 않고 일반 python 코드와 같은 테스트를 작성할 수 있다.</p>
<h3 id="분산--확장-가능---수-십만의-유저-지원">분산 &amp; 확장 가능 - 수 십만의 유저 지원</h3>
<p>Locust를 사용하면 분산된 부하 테스트를 여러 시스템에 쉽게 동작 시킬 수 있다. gevent를 사용하는 이벤트 기반이기 때문에, 단일 프로세스에서도 수 천의 동접 유저 처리를 할 수 있다. 더 많은 요청을 수행할 수 있는 다른 도구가 있을 수 있지만, Locust의 각 유저의 낮은 오버헤드는 동시 부하를 테스트하는데 적합하다.</p>
<h3 id="web-based-ui">Web-based UI</h3>
<p>Locust는 플라스크를 사용해서 webUI를 서빙한다. 따라서 web endpoint를 추가하기 쉽다. Flask Blueprints와 templates를 사용할 수 있다.
Locust는 유저 친화적인 웹 인터페이스로 테스트를 실시간으로 보여 준다. UI 없이도 사용해서 CI/CD 테스트에서도 쉽게 사용할 수 있다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">locust</span> <span style="color:#080;font-weight:bold">import</span> events

<span style="color:#555;font-weight:bold">@events.init.add_listener</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">on_locust_init</span>(web_ui, <span style="color:#333">**</span>kw):
    <span style="color:#555;font-weight:bold">@web_ui.app.route</span>(<span style="background-color:#fff0f0">&#39;/added_page&#34;)</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">my_added_page</span>():
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:#fff0f0">&#34;Another page&#34;</span>
</code></pre></div><h3 id="can-test-any-system">Can test any system</h3>
<h2 id="how-to-">How to ~</h2>
<h3 id="설치-하기">설치 하기</h3>
<p>| pip 을 사용한 설치</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pip3 install locust
$ locust -v 
</code></pre></div><h3 id="실행-하기">실행 하기</h3>
<p>| 특정 Path에 위치한 Locust 파일을 실행하기</p>
<ul>
<li>&ndash;master</li>
<li>&ndash;worker</li>
<li>&ndash;headless</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ locust -f locust_files/my_locust_file.py <span style="color:#888"># http://127.0.0.1:8089</span>
</code></pre></div><p>| Docker-Compose를 사용해 실행하기</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ docker-compose up --scale <span style="color:#963">worker</span><span style="color:#333">=</span><span style="color:#60e;font-weight:bold">4</span>
</code></pre></div><h2 id="writing-a-locusfile">Writing a locusfile</h2>
<p>locustfile은 일반적인 python 파일이다. 최소 User 클래스를 상속 받는 클래스 하나면 필요하다.</p>
<h3 id="user-class">User class</h3>
<p>Locust는 각 시뮬레이트 될 각 유저 마다 User 클래스의 인스턴스를 생성한다. <br>
User 클래스에서 정의해줘야 하는 공통 attribute들이 존재한다.</p>
<p><!-- raw HTML omitted -->wait_time attribute<!-- raw HTML omitted --></p>
<p><code>Users</code> 클래스의 <code>wait_time</code> 메소드는 optional attribute로 가상 유저들이 대기해야하는 태스크들 사이의 시간이 필요할 때 사용한다. <code>wait_time</code>이 정의되지 않으면 새로운 태스크는 대기 없이 바로 실행된다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">locust</span> <span style="color:#080;font-weight:bold">import</span> User, task, between

<span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">MyUser</span>(User):
   <span style="color:#555;font-weight:bold">@task</span>
   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">my_task</span>(self):
        <span style="color:#080;font-weight:bold">print</span>(<span style="background-color:#fff0f0">&#34;Executing my_task&#34;</span>)
   
   wait_time <span style="color:#333">=</span> between(<span style="color:#60e;font-weight:bold">0.5</span>, <span style="color:#00d;font-weight:bold">10</span>)
</code></pre></div><p><!-- raw HTML omitted -->weight attritubute<!-- raw HTML omitted --></p>
<p>하나 이상의 User 클래스가 파일에 존재하거나, User 클래스들이 커맨드 라인에 구체화 되지 않았을 때 Locust는 각 User 클래스들을 동일한 수 만큼 생성한다.
동일한 파일 내에서 어떤 User 클래스를 특정할 지, 커맨드 라인에서 정할 수 있다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ locust -f locust_file.py WebUser Mobile User
</code></pre></div><p>weight attribute를 클래스에서 사용해서 더 많은 유저들로 시뮬레이트 할 수 있다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">WebUser</span>(User):
    weight <span style="color:#333">=</span> <span style="color:#00d;font-weight:bold">3</span>
    <span style="color:#333">...</span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">MobileUser</span>(User):
    weight <span style="color:#333">=</span> <span style="color:#00d;font-weight:bold">1</span>
    <span style="color:#333">...</span>
</code></pre></div><p><!-- raw HTML omitted -->host attribute<!-- raw HTML omitted --></p>
<p>커맨드 라인에서 <code>--host</code> 옵션을 사용할 수 있으나 WebUI에서 입력할 수 있다.</p>
<p><!-- raw HTML omitted -->tasks attribute<!-- raw HTML omitted --></p>
<p>User 클래스는 메소드로 정의된 태스크를 <code>@task</code> 데코레이터를 사용해서 선언할 수 있다. <br>
tasks attribute를 사용해서도 할 수 있다.</p>
<p><!-- raw HTML omitted -->environment attribute<!-- raw HTML omitted -->
&hellip;</p>
<p><!-- raw HTML omitted -->on_start &amp; on_stop 메소드<!-- raw HTML omitted -->
User ( 그리고 TaskSets ) 가 선언할 수 있다.</p>
<ul>
<li>User : <code>on_start</code> 메소드는 running 시작 시에, <code>on_stop</code> 메소드는 running 이 멈춘 뒤호출 된다.</li>
<li>TaskSet : <code>on_start</code> 메소드는 TaskSet을 가상 유저가 실행 시에, <code>on_stop</code>은 가상 유저의 TaskSet 실행이 멈추거나, 유저가 죽을 때 호출 된다.</li>
</ul>
<h3 id="tasks">Tasks</h3>
<p><!-- raw HTML omitted --> tasks attribute <!-- raw HTML omitted --></p>
<p>task를 선언하는 다른 방법 중 하나이다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">locust</span> <span style="color:#080;font-weight:bold">import</span> User, constant

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">my_task</span>(user)
    <span style="color:#080;font-weight:bold">pass</span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">MyUser</span>(User):
    tasks <span style="color:#333">=</span> [my_task]
    wait_time <span style="color:#333">=</span> constant(<span style="color:#00d;font-weight:bold">1</span>)
</code></pre></div><p><!-- raw HTML omitted --> @task decorator<!-- raw HTML omitted -->
<!-- raw HTML omitted --> @tag decorator<!-- raw HTML omitted --></p>
<h3 id="events">Events</h3>
<p>테스트의 한 파트로 일부 설정 코드를 사용하기에 locustfile에 모듈 레벨로 두는 것으로 충분하지만, <br>
실행 중에 특정 시간에 작업을 하는 경우에는 Locust에서 제공하는 event 훅을 사용하면 된다.</p>
<p><!-- raw HTML omitted -->test_start &amp; test_stop<!-- raw HTML omitted -->
부하 테스트 start 혹은 stop 시, 일부 코드를 실행해야 하는 경우, <code>test_start</code>와 <code>test_stop</code> 이벤트를 사용해야 한다. locust 모듈 수준에서 이러한 이벤트에 대한 리스너를 설정할 수 있다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">locust</span> <span style="color:#080;font-weight:bold">import</span> events

<span style="color:#555;font-weight:bold">@events.test_start.add_listener</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">on_test_start</span>(environment, <span style="color:#333">**</span>kwargs):
    <span style="color:#080;font-weight:bold">print</span>(<span style="background-color:#fff0f0">&#34;A new test is starting&#34;</span>)

<span style="color:#555;font-weight:bold">@events.test_stop.add_listener</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">on_test_stop</span>(environment, <span style="color:#333">**</span>kwargs):
    <span style="color:#080;font-weight:bold">print</span>(<span style="background-color:#fff0f0">&#34;A new test is ending&#34;</span>)
</code></pre></div><p><!-- raw HTML omitted -->init<!-- raw HTML omitted -->
<code>init</code> 이벤트는 각 Locust 프로세스가 시작 될 때, 트리거 된다. <br>
분산 모드에서 각 워커 프로세스가 초기화 시에 뭔가 해야 할 일이 필요한 경우에 특히 유용하다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">locust</span> <span style="color:#080;font-weight:bold">import</span> events
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">locust.runner</span> <span style="color:#080;font-weight:bold">import</span> MasterRunner

<span style="color:#555;font-weight:bold">@events.init.add_listener</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">on_locust_init</span>(environment, <span style="color:#333">**</span>kwargs):
    <span style="color:#080;font-weight:bold">if</span> <span style="color:#007020">isinstance</span>(environment<span style="color:#333">.</span>runner, MasterRunner):
        <span style="color:#080;font-weight:bold">print</span>(<span style="background-color:#fff0f0">&#34;I&#39;m on master node&#34;</span>)
    <span style="color:#080;font-weight:bold">else</span>:
        <span style="color:#080;font-weight:bold">print</span>(<span style="background-color:#fff0f0">&#34;I&#39;m on worker or standalone node&#34;</span>)
</code></pre></div><h3 id="httpuser-class">HttpUser class</h3>
<p><!-- raw HTML omitted -->Validating responses<!-- raw HTML omitted -->
리쿼스트 들은 HTTP response code 가 OK 시에 성공으로 판단된다. (&lt; 400)  <br>
그러나 추가 validation이 필요한 경우에 사용 될 수 있다.</p>
<ul>
<li>catch_response 파라미터</li>
<li>with 구문</li>
<li>response.failure() 호출</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">with</span> self<span style="color:#333">.</span>client<span style="color:#333">.</span>get(<span style="background-color:#fff0f0">&#34;/&#34;</span>, catch_response<span style="color:#333">=</span>True) <span style="color:#080;font-weight:bold">as</span> response:
    <span style="color:#080;font-weight:bold">if</span> response<span style="color:#333">.</span>text <span style="color:#333">!=</span> <span style="background-color:#fff0f0">&#34;Success&#34;</span>:
        response<span style="color:#333">.</span>failure(<span style="background-color:#fff0f0">&#34;Got wrong response&#34;</span>)
    <span style="color:#080;font-weight:bold">elif</span> response<span style="color:#333">.</span>elapsed<span style="color:#333">.</span>total_seconds() <span style="color:#333">&gt;</span> <span style="color:#60e;font-weight:bold">0.5</span>:
        response<span style="color:#333">.</span>failure(<span style="background-color:#fff0f0">&#34;Request took too long&#34;</span>)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">with</span> self<span style="color:#333">.</span>client<span style="color:#333">.</span>get(<span style="background-color:#fff0f0">&#34;/does_not_exist/&#34;</span>, catch_response<span style="color:#333">=</span>True) <span style="color:#080;font-weight:bold">as</span> response
    <span style="color:#080;font-weight:bold">if</span> response<span style="color:#333">.</span>status_code <span style="color:#333">==</span> <span style="color:#00d;font-weight:bold">404</span>:
        response<span style="color:#333">.</span>success()
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">json</span> <span style="color:#080;font-weight:bold">import</span> JSONDecodeError
<span style="color:#333">...</span>
<span style="color:#080;font-weight:bold">with</span> self<span style="color:#333">.</span>client<span style="color:#333">.</span>post(<span style="background-color:#fff0f0">&#34;/&#34;</span>, json<span style="color:#333">=</span>{<span style="background-color:#fff0f0">&#34;foo&#34;</span>:<span style="color:#00d;font-weight:bold">42</span>, <span style="background-color:#fff0f0">&#34;bar&#34;</span>:None}, catch_response<span style="color:#333">=</span>True) <span style="color:#080;font-weight:bold">as</span> response:
    <span style="color:#080;font-weight:bold">try</span>:
        <span style="color:#080;font-weight:bold">if</span> response<span style="color:#333">.</span>json()[<span style="background-color:#fff0f0">&#39;greeting&#39;</span>] <span style="color:#333">!=</span> <span style="background-color:#fff0f0">&#39;hello&#39;</span>:
            response<span style="color:#333">.</span>failure(<span style="background-color:#fff0f0">&#39;Did not get expected value in greeting&#39;</span>)
    <span style="color:#080;font-weight:bold">except</span> JSONDecodeError:
        response<span style="color:#333">.</span>failure(<span style="background-color:#fff0f0">&#34;Response could not be decoded as JSON&#34;</span>)
    <span style="color:#080;font-weight:bold">except</span> <span style="color:#f00;font-weight:bold">KeyError</span>:
        response<span style="color:#333">.</span>failure(<span style="background-color:#fff0f0">&#34;Response did not contain expected key &#39;greeting&#39;&#34;</span>)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#007020">range</span>(<span style="color:#00d;font-weight:bold">10</span>):
    self<span style="color:#333">.</span>client<span style="color:#333">.</span>get(<span style="background-color:#fff0f0">&#34;/blog?id=</span><span style="background-color:#eee">%i</span><span style="background-color:#fff0f0">&#34;</span> <span style="color:#333">%</span> i, name<span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;/blog?id=[id]&#34;</span>)
</code></pre></div><h2 id="advanced">Advanced</h2>
<h3 id="locust의-성능을-향상-시키기-faster-http-client">Locust의 성능을 향상 시키기 faster HTTP client</h3>
<p>Locust의 기본 HTTP client는 python-request이다. 잘 관리되는 파이썬 패키지이고 사용하는 것이 권장 된다.  <br>
만약 굉장히 거대한 규모의 테스트를 계획한다면, 다른 HTTP Client를 대안으로 사용할 수 있다. <code>FastHttpUser</code>를 사용해서 geventhttpclient로 requests를 하는 것이다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">FastLargeScaleUser</span>(FastHttpUser):
        wait_time <span style="color:#333">=</span> between(<span style="color:#00d;font-weight:bold">2</span>, <span style="color:#00d;font-weight:bold">5</span>)

        <span style="color:#555;font-weight:bold">@task</span> 
        <span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">index</span>(self):
            response <span style="color:#333">=</span> self<span style="color:#333">.</span>client<span style="color:#333">.</span>get(<span style="background-color:#fff0f0">&#34;/&#34;</span>)
</code></pre></div><h3 id="커스텀-load-형태-생성">커스텀 load 형태 생성</h3>
<p>load spike를 생성하거나 지정한 시간에 늘리거나 줄이는 것을 원한다면, <code>LoadTestShape</code> 클래스를 사용해서 컨트롤 할 수 있다. <br>
해당 클래스에서 <code>tick()</code> 메소드를 정의할 수 있는데 Locust는 메소드를 초당 한번 호출한다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">MyCustomShape</span>(LoadTestShape):
        time_limit <span style="color:#333">=</span> <span style="color:#00d;font-weight:bold">600</span>
        spawn_rate <span style="color:#333">=</span> <span style="color:#00d;font-weight:bold">20</span> 

        <span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">tick</span>(self):
            run_time <span style="color:#333">=</span> self<span style="color:#333">.</span>get_run_time() <span style="color:#888"># check time how long the test run for</span>
            <span style="color:#888"># user_count = get_current_user_count()</span>

            <span style="color:#080;font-weight:bold">if</span> run_time <span style="color:#333">&lt;</span> self<span style="color:#333">.</span>time_limit:
                user_count <span style="color:#333">=</span> <span style="color:#007020">round</span>(run_time, <span style="color:#333">-</span><span style="color:#00d;font-weight:bold">2</span>)
                <span style="color:#080;font-weight:bold">return</span> (user_count, spawn_rate)
            <span style="color:#080;font-weight:bold">return</span> None
</code></pre></div><h3 id="로깅">로깅</h3>
<p>Locust는 python의 빌트인 로깅 프레임워크를 사용해서 로그를 핸들링한다.</p>
<h3 id="user-class-1">User class</h3>
<blockquote>
<p>class User(environment)</p>
</blockquote>
<p>생성될 &lsquo;user&rsquo;를 나타내며 로드 테스트할 시스템을 공격한다. 이 유저의 행동은 task로 정의된다.<br>
Tasks는 <code>@task decorator</code> 메소드를 사용하거나 <code>tasks attribute</code>를 세팅함으로 선언된다.</p>
<ul>
<li>
<p>abstract() : True면, 클래스가 서브 클래스가 된다. 테스트 중에 유저들을 생성하지 않는다.</p>
</li>
<li>
<p>on_start() : User가 running을 시작할 때 호출된다.</p>
</li>
<li>
<p>on_stop() : User가 running을 멈출 때 호출된다.</p>
</li>
<li>
<p>tasks() : python으로 호출 가능한 태스크셋 클래스들의 Collection</p>
<ul>
<li>list : 태스크가 랜덤으로 선택되어 동작된다.</li>
<li>두개 이상의 tuple(callable, int)로 구성된 list나 dict 시에 int 값으로 가중되게 선택되어 동작한다.</li>
</ul>
</li>
<li>
<p>wait() : User.wait_time 함수로 정의된 시간동안 동작 중인 유저를 sleep</p>
</li>
<li>
<p>wait_time() : locusts 태스크들 실행 간 시간을 반환하는 메소드</p>
</li>
</ul>
<h3 id="taskset-class">TaskSet class</h3>
<blockquote>
<p>class TaskSet(parent)</p>
</blockquote>
<p>User가 실행할 태스크들의 셋을 정의하는 클래스
태스크셋이 동작하기 시작했을 때, tasks attribute로 부터 task를 선택하고, 실행하고, wait_time 함수로 반환된 초 만큼 sleep 한다.  <br>
태스크셋은 중첩될 수 있다.</p>
<h3 id="task-decorator">task decorator</h3>
<blockquote>
<p>task(weight=1)</p>
</blockquote>
<p>User 또는 TaskSet에 대한 작업을 클래스에서 in-line으로 선언 할 수있는 편리한 데코레이터로 사용된다.</p>
<h3 id="tag-decorator">tag decorator</h3>
<blockquote>
<p>tag(*tag)</p>
</blockquote>
<p>주어진 태그명으로 tasks와 TaskSets를 태깅하는 데코레이터</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">ForumPage</span>(TaskSet):
    <span style="color:#555;font-weight:bold">@tag</span>(<span style="background-color:#fff0f0">&#39;thread&#39;</span>)
    <span style="color:#555;font-weight:bold">@task</span>(<span style="color:#00d;font-weight:bold">100</span>)
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">read_thread</span>(self):
        <span style="color:#080;font-weight:bold">pass</span> 
    
    <span style="color:#555;font-weight:bold">@tag</span>(<span style="background-color:#fff0f0">&#39;thread&#39;</span>)
    <span style="color:#555;font-weight:bold">@tag</span>(<span style="background-color:#fff0f0">&#39;post&#39;</span>)
    <span style="color:#555;font-weight:bold">@task</span>(<span style="color:#00d;font-weight:bold">7</span>)
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">create_thread</span>(self):
        <span style="color:#080;font-weight:bold">pass</span>
</code></pre></div><h3 id="sequentialtaskset-class">SequentialTaskSet class</h3>
<blockquote>
<p>SequentialTaskSet(*args, **kwargs)</p>
</blockquote>
<p>User가 실행할 태스크 들의 시퀀스를 선언하는 클래스 <br>
TaskSet 클래스 처럼 동작하지만, task weight가 무시된다. 모든 태스크들이 순서대로 실행된다.</p>
<h3 id="빌트인-wait_time-함수들">빌트인 wait_time 함수들</h3>
<blockquote>
<p>between(min_wait, max_wait)</p>
</blockquote>
<p>min_wait ~ max_wait 간 랜덤 넘버를 반환한다.</p>
<blockquote>
<p>constant(wait_time)</p>
</blockquote>
<p>wait_time으로 고정된 넘버를 반환한다.</p>
<blockquote>
<p>constant_pacing(wait_time)</p>
</blockquote>
<p>Task의 실행 시간을 트래킹하는 함수를 반환하고 호출 마다 Task 실행 시간 사이의 총 시간을 wait_time 인수에 지정된 시간과 동일하게 만들려고 하는 대기 시간을 반환한다.
만약 task 실행 시간이 선언된 wait_time 초과 되면, 다음 task 실행 시 까지 wait가 0가 된다.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#080;font-weight:bold">class</span> <span style="color:#b06;font-weight:bold">MyUser</span>(User):
        wait_time <span style="color:#333">=</span> between(<span style="color:#60e;font-weight:bold">3.0</span>, <span style="color:#60e;font-weight:bold">10.5</span>)
        <span style="color:#888">#wait_time = constant(3)</span>
        <span style="color:#888">#wait_time = constant_pacing(1)</span>

        <span style="color:#555;font-weight:bold">@task</span>
        <span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">my_task</span>(self):
            time<span style="color:#333">.</span>sleep(random<span style="color:#333">.</span>random())
</code></pre></div><h3 id="httpsession-class">HttpSession class</h3>
<p>WHAT?</p>
<h3 id="response-class">Response class</h3>
<p>이 클래스는 python-requests 라이브러리 내에 위치, request 문서에서 확인할 수 있음.
HTTP request에 대한 서버의 응답을 담고 있는 <code>Response</code> object</p>
<blockquote>
<p>class Response</p>
</blockquote>
<ul>
<li>property
<ul>
<li>apparent_encoding</li>
<li>is_permanent_redirect</li>
<li>is_redirect</li>
<li>content ( 바이트 형태의 response content )</li>
</ul>
</li>
<li>close()</li>
<li>cookies = None</li>
<li>elapsed = None ( request를 보내고 response 도달 까지의 시간 )</li>
<li>encoding = None ( r.text를 디코딩 하기 위한 인코딩 )</li>
<li>headers = None</li>
<li>history = None</li>
<li>iter_content(chunk_size=1, decode_unicode=False)
<ul>
<li>response 데이터에 대해 iterate stream=True일 때, 긴 response에 대해 content를 메모리를  한번에 올리지 않는다. chunk_size 만큼 메모리에 올리고, 지정된 unicode로 decode )</li>
</ul>
</li>
<li>iter_lines(chunk_size=1, decode_unicode=False, delimeter=None)
<ul>
<li>한번에 한 라인</li>
</ul>
</li>
<li>json(**kwargs)
<ul>
<li>json 인코딩된 response의 content를 반환한다.
<ul>
<li>Parameters</li>
<li>Raises</li>
</ul>
</li>
<li>property
<ul>
<li>links</li>
<li>next</li>
<li>ok</li>
<li>text</li>
</ul>
</li>
<li>raise_for_status()</li>
<li>raw = None</li>
<li>reason = None</li>
<li>request = None</li>
<li>status_code = None</li>
<li>url = None</li>
</ul>
</li>
</ul>
<h3 id="responsecontextmanager-class">ResponseContextManager class</h3>
<blockquote>
<p>class ResponseContextManager(response, request_access, request_failure)</p>
</blockquote>
<p>HTTP 요청이 Locust 통계에서 성공 또는 실패로 표시되어야 하는지 여부를 수동으로 제어하는 기능을 제공하는 context manager 역할도 하는 response class</p>
<p>이 클래스는 <code>Response</code>의 서브 클래스로 success와 failure 두가지 메소드가 추가 되었다.</p>
<blockquote>
<p>failure(exc)</p>
</blockquote>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#080;font-weight:bold">with</span> self<span style="color:#333">.</span>client<span style="color:#333">.</span>get(<span style="background-color:#fff0f0">&#34;/&#34;</span>, catch_response<span style="color:#333">=</span>True) <span style="color:#080;font-weight:bold">as</span> response:
        <span style="color:#080;font-weight:bold">if</span> response<span style="color:#333">.</span>content <span style="color:#333">==</span> <span style="background-color:#fff0f0">b</span><span style="background-color:#fff0f0">&#34;&#34;</span>:
            response<span style="color:#333">.</span>failure(<span style="background-color:#fff0f0">&#34;No data&#34;</span>)
</code></pre></div><blockquote>
<p>success(exc)</p>
</blockquote>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#080;font-weight:bold">with</span> self<span style="color:#333">.</span>client<span style="color:#333">.</span>get(<span style="background-color:#fff0f0">&#34;/does/not/exist&#34;</span>, catch_response<span style="color:#333">=</span>True) <span style="color:#080;font-weight:bold">as</span> response:
        <span style="color:#080;font-weight:bold">if</span> response<span style="color:#333">.</span>status_code <span style="color:#333">==</span> <span style="color:#00d;font-weight:bold">404</span>:
            response<span style="color:#333">.</span>success()
</code></pre></div>
	</div>
	
	
	
	
	
	
	
	<div class="tags">
		<div class="taxosfloating_left">
			<p>Categories</p>
		</div>
		<div class="termsfloating_right">
			<p>
			
			
			
			
			
			<a href="/categories/open-source/"> open-source </a>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			</p>
		</div>
		<div class="clearit"></div>
		
		
		
		
	
		
	
	
	
	<div class="tags">
		<div class="taxosfloating_left">
			<p>Tags</p>
		</div>
		<div class="termsfloating_right">
			<p>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<a href="/tags/loadtest/"> loadtest </a>
			
			
			
			
			
			<a href="/tags/locust/"> locust </a>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<a href="/tags/opensource/"> opensource </a>
			
			
			
			
			
			
			
			
			
			<a href="/tags/python/"> python </a>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			</p>
		</div>
		<div class="clearit"></div>
		
		
		
		
		
	</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
	(function() {
	    
	    
	    if (window.location.hostname == "localhost")
	        return;
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    var disqus_shortname = 'Slave';
	    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to load the comments.</noscript>


</div>

  </main>
<footer>
	 © Copyright notice | <a href="https://github.com/dataCobra/hugo-vitae">Vitae</a> theme for <a href="https://gohugo.io">Hugo</a> 
	
	
	
</footer>


</body>
</html>
